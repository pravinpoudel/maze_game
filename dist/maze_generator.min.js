"use strict";function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}function ownKeys(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,a)}return r}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(r,!0).forEach(function(e){_defineProperty(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys(r).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var w,canvas,ctx,IMG,player,startPosition,endPosition,startIndex,endIndex,playerImage,destinationImage,rows=15,cols=15,cellSet=[],path=[],wall_list=[],removedWallSet={},previousTime=new Date,first=!0,keyDown={},history=[],isBreadcumbVisible=!0,isHintVisible=!1,isPathVisible=!1,score=0,gameOver=!1,scoreList=[],buttonDiv=document.getElementById("maze_size");function processInput(e){keyDown.w&&canMove("w")&&0<player.y&&(history.push({x:player.x,y:player.y}),player.y=player.y-1,updateScore()),keyDown.a&&canMove("a")&&0<player.x&&(history.push({x:player.x,y:player.y}),player.x=player.x-1,updateScore()),keyDown.s&&canMove("s")&&player.y<rows-1&&(history.push({x:player.x,y:player.y}),player.y=player.y+1,updateScore()),keyDown.d&&canMove("d")&&player.x<cols-1&&(history.push({x:player.x,y:player.y}),player.x=player.x+1,updateScore()),keyDown.b&&(isBreadcumbVisible=!isBreadcumbVisible),keyDown.h&&(isHintVisible=!isHintVisible),keyDown.p&&(isPathVisible=!isPathVisible),keyDown={}}function canMove(e){var t={};"s"==e&&(t.x0=player.x,t.y0=player.y+1,t.x1=player.x+1,t.y1=player.y+1),"d"==e&&(t.x0=player.x+1,t.y0=player.y,t.x1=player.x+1,t.y1=player.y+1),"w"==e&&(t.x0=player.x,t.y0=player.y,t.x1=player.x+1,t.y1=player.y),"a"==e&&(t.x0=player.x,t.y0=player.y,t.x1=player.x,t.y1=player.y+1);for(var r=0;r<wall_list.length;r++)if(wall_list[r].x0==t.x0&&wall_list[r].y0==t.y0&&wall_list[r].x1==t.x1&&wall_list[r].y1==t.y1)return!1;return!0}function updateScore(){var e=player.x+player.y*cols;e!=endIndex&&(e==path[path.length-2].x+path[path.length-2].y*cols?score+=5:score-=2)}function drawSprite(){ctx.drawImage(playerImage,player.x*w,player.y*w,w,w),ctx.drawImage(destinationImage,cellSet[0][endPosition].x*w,cellSet[0][endPosition].y*w,w,w)}function showTrack(e,t){var r,a;ctx.fillStyle=t,e.forEach(function(e,t){ctx.beginPath(),r=e.x*w+w/2,a=e.y*w+w/2,ctx.arc(r,a,w/4,2*Math.PI,!1),ctx.fill()})}function randInt(e){return Math.floor(Math.random()*e)}function putBackground(){ctx.drawImage(img,0,0,img.width,img.height,0,0,canvas.width,canvas.height),ctx.fillStyle="#4aa1b0cc",ctx.fillRect(0,0,canvas.width,canvas.height)}function render(e){timeDiv.innerText=Math.floor(e/1e3)+" sec",scoreBoard.innerText=score,ctx.clearRect(0,0,canvas.width,canvas.height),drawStartAndEnd(startPosition,endPosition),isPathVisible&&showTrack(path,"#939ea0"),isBreadcumbVisible&&showTrack(history,"#556611"),!isHintVisible||1<path.length&&showTrack([path[path.length-2]],"#939ea0");show(),drawSprite(),scoreList.push(score),gameOver&&(gameOverBoard.innerText="You Won !!!!",highscoreBoard.innerText=Math.max.apply(Math,scoreList))}function drawStartAndEnd(e,t){cellSet[0][e].x,cellSet[0][e].y,cellSet[0][t].x,cellSet[0][t].y}function findShortestLength(e,t){var r,a,l=[],o=new Array(rows*cols).fill(-1);for(l.push(e),o[e]=0;0<l.length;){var n=l.shift(),i=[n-cols,n+cols];n%cols==0?i.push(n+1):(n%cols==cols-1||i.push(n+1),i.push(n-1));for(var s=0;s<i.length;s++)r=i[s]+"_"+n,a=n+"_"+i[s],(removedWallSet[r]||removedWallSet[a])&&i[s]<rows*cols&&0<=i[s]||(i.splice(s,1),s--);for(var c=0;c<i.length;c++)if(-1==o[i[c]]&&(o[i[c]]=o[n]+1,l.push(i[c]),i[c]==t))return o}}function findShortestPath(e,t){var r=findShortestLength(e,t),a=t;path.push(t);for(var l=r[t];0<l;){l=r[a];var o=[a-cols,a+cols];a%cols==0?o.push(a+1):(a%cols==cols-1||o.push(a+1),o.push(a-1));for(var n=0;n<o.length;n++)comb1=o[n]+"_"+a,comb2=a+"_"+o[n],(removedWallSet.hasOwnProperty(comb1)||removedWallSet.hasOwnProperty(comb2))&&o[n]<rows*cols&&0<=o[n]||(o.splice(n,1),n--);l--;for(var i=0;i<o.length;i++)if(r[o[i]]==l){path.push(o[i]);break}a=path[path.length-1]}for(var s=0,c=path.length;s<c;s++){var y=Math.floor(path[s]/cols),p=path[s]%cols;path[s]={x:p,y:y}}}function setup(){canvas=document.getElementById("mazecanvas"),ctx=canvas.getContext("2d");var e=canvas.width,t=canvas.height;w=Math.floor(e/rows),h=Math.floor(t/cols),img=new Image,img.src="./background.jpg";for(var r=0;r<rows;r++)for(var a=0;a<cols;a++)cellSet.push([{index:r+a*cols,x:r,y:a}]);for(var l=0;l<rows;l++)for(var o=0;o<cols;o++){var n=l,i=o,s=l+1,c=o;wall_list.push({x0:n,y0:i,x1:s,y1:c}),s=l,c=o+1,wall_list.push({x0:n,y0:i,x1:s,y1:c})}for(var y=0,p=cols;y<rows;y++){var d=y,u=p,x=y+1,f=p;wall_list.push({x0:d,y0:u,x1:x,y1:f})}for(var g=0,v=rows;g<cols;g++){var m=v,S=g,b=v,I=g+1;wall_list.push({x0:m,y0:S,x1:b,y1:I})}}function mazeGeneration(){for(;1<cellSet.length;){var e=-1,t=-1,r=randInt(wall_list.length),a=void 0,l=void 0;if(wall_list[r].y0==wall_list[r].y1)for(var o=wall_list[r].x0,n=wall_list[r].y0,i=0;i<cellSet.length;i++)for(var s=0;s<cellSet[i].length;s++)cellSet[i][s].x==o&&cellSet[i][s].y==n&&(a=cellSet[e=i][s].index),cellSet[i][s].x==o&&cellSet[i][s].y==n-1&&(l=cellSet[t=i][s].index);if(wall_list[r].x0==wall_list[r].x1)for(var c=wall_list[r].x0,y=wall_list[r].y0,p=0;p<cellSet.length;p++)for(var d=0;d<cellSet[p].length;d++)cellSet[p][d].x==c-1&&cellSet[p][d].y==y&&(a=cellSet[e=p][d].index),cellSet[p][d].x==c&&cellSet[p][d].y==y&&(l=cellSet[t=p][d].index);if(0<=e&&0<=t&&e!=t){for(var h=0;h<cellSet[t].length;h++)cellSet[e][cellSet[e].length]=_objectSpread({},cellSet[t][h]);var w=l+"_"+a;removedWallSet[a+"_"+l]=!0,removedWallSet[w]=!0,wall_list.splice(r,1),cellSet.splice(t,1)}}}function update(e){var t=player.x+player.y*cols;path=[],t!=endIndex?findShortestPath(t,endIndex):gameOver=!0}function show(){for(var e=0;e<wall_list.length;e++)start=[wall_list[e].x0*w,wall_list[e].y0*w],end=[wall_list[e].x1*w,wall_list[e].y1*w],drawLine(ctx,start,end,"#6b789e",2)}function drawLine(e,t,r){var a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"white",l=4<arguments.length&&void 0!==arguments[4]?arguments[4]:1;a&&(e.strokeStyle=a),l&&(e.lineWidth=l),e.beginPath(),e.moveTo.apply(e,_toConsumableArray(t)),e.lineTo.apply(e,_toConsumableArray(r)),e.stroke()}function spriteLoad(){(playerImage=new Image).src="./sprites/player.png",(destinationImage=new Image).src="./sprites/destination.png",playerImage.onload=function(){ctx.drawImage(playerImage,player.x*w,player.y*w)},destinationImage.onload=function(){console.log(cellSet[0][endPosition].x*w,cellSet[0][endPosition].y*w),ctx.drawImage(destinationImage,cellSet[0][endPosition].x*w,cellSet[0][endPosition].y*w,w,w)}}function init(){for(setup(),mazeGeneration();startPosition=randInt(cellSet[0].length),endPosition=randInt(cellSet[0].length),startPosition==endPosition;);spriteLoad(),startIndex=cellSet[0][startPosition].index,endIndex=cellSet[0][endPosition].index;findShortestLength(startIndex,endIndex);player={x:cellSet[0][startPosition].x,y:cellSet[0][startPosition].y},findShortestPath(startIndex,endIndex)}buttonDiv.onclick=function(e){rows=e.srcElement.dataset.value,cols=Number(rows),rows=Number(rows),cellSet=[],removedWallSet={},wall_list=[],path=[],history=[],isBreadcumbVisible=first=!0,score=0,gameOver=!(keyDown={}),gameOverBoard.innerText="",gameLoop()},window.addEventListener("keydown",function(e){var t=e.key;"w"!=t&&"i"!=t&&"ArrowUp"!=t||(t="w"),"a"!=t&&"j"!=t&&"ArrowLeft"!=t||(t="a"),"s"!=t&&"k"!=t&&"ArrowDown"!=t||(t="s"),"d"!=t&&"l"!=t&&"ArrowRight"!=t||(t="d"),keyDown[t]=!0});var timeDiv=document.getElementById("elapsedTime"),scoreBoard=document.getElementById("scoreBoard"),highscoreBoard=document.getElementById("highscoreBoard"),gameOverBoard=document.getElementById("gamOverBoard");function gameLoop(e){first&&(first=!1,init());var t=e-lastRender;processInput(t),update(t),render(t),gameOver||requestAnimationFrame(gameLoop)}var lastRender=0;
//# sourceMappingURL=maze_generator.min.js.map
